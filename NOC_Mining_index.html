<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NOC Mining Dashboard</title>

<style>
  :root{
    --bg:#0b0e11; --panel:#11151a; --border:#1f2630;
    --text:#e6e6e6; --muted:#9aa4b2; --accent:#00ff9c;
  }
  *{box-sizing:border-box}
  body{
    margin:0; padding:8px; background:var(--bg); color:var(--text);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    height:100vh;
  }
  header{
    display:flex; justify-content:space-between; align-items:center;
    padding:6px 10px; border-bottom:1px solid var(--border); margin-bottom:8px;
  }
  header h1{margin:0; font-size:14px; color:var(--accent)}
  header .meta{font-size:11px; color:var(--muted)}
  main{
    display:grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr auto;
    gap:8px; height: calc(100vh - 48px);
  }
  .panel{
    background:var(--panel); border:1px solid var(--border);
    display:flex; flex-direction:column; overflow:hidden;
  }
  .panel h2{
    margin:0; padding:4px 6px; font-size:12px; color:var(--muted);
    border-bottom:1px solid var(--border);
    display:flex; justify-content:space-between; align-items:center;
  }
  .badge{font-size:10px; color:var(--muted)}
  pre{
    margin:0; padding:6px; flex:1; overflow:auto;
    white-space:pre-wrap; font-size:13px; line-height:1.25;
  }
  .bottom{
    grid-column: span 2;
    display:grid; grid-template-columns: 1fr 1fr 1fr;
    gap:8px; height: 22vh;
  }
</style>
</head>

<body>
<header>
  <h1>NOC Mining Dashboard</h1>
  <div class="meta" id="meta">Loading…</div>
</header>

<main>
  <section class="panel">
    <h2>Blockwatch — Log <span class="badge" id="src-bw">detecting…</span></h2>
    <pre id="bw">Loading…</pre>
  </section>

  <section class="panel">
    <h2>Walletguard — Log <span class="badge" id="src-wg">detecting…</span></h2>
    <pre id="wg">Loading…</pre>
  </section>

  <section class="bottom">
    <div class="panel">
      <h2>Last Block Found <span class="badge" id="src-bf">detecting…</span></h2>
      <pre id="bf">Loading…</pre>
    </div>
    <div class="panel">
      <h2>Chain Height <span class="badge" id="src-h">detecting…</span></h2>
      <pre id="h">Loading…</pre>
    </div>
    <div class="panel">
      <h2>Status <span class="badge" id="src-s">detecting…</span></h2>
      <pre id="s">Loading…</pre>
    </div>
  </section>
</main>

<script>
  // Refresh interval (ms)
  const REFRESH_MS = 5000;

  // Candidate URL lists (we'll try each in order and use the first that works)
  // Includes BOTH styles you've used historically:
  // - flat: /bf_log.txt
  // - foldered: /blockwatch/bf_log.txt
  const CANDIDATES = {
    blockwatchLog: ["bf_log.txt", "blockwatch/bf_log.txt"],
    walletguardLog: ["heartbeat.log", "walletguard/heartbeat.log"],
    blockfound: ["blockfound.txt", "blockwatch/blockfound.txt"],
    height: ["height.txt", "blockwatch/height.txt"],
    status: ["heartbeat.txt", "walletguard/heartbeat.txt"]
  };

  async function firstWorkingUrl(urls){
    for (const u of urls){
      try{
        const r = await fetch(u, { cache: "no-store" });
        if (r.ok) return u;
      } catch(e) {}
    }
    return null;
  }

  async function loadInto(preId, badgeId, urlList){
    const pre = document.getElementById(preId);
    const badge = document.getElementById(badgeId);

    // Cache the chosen URL so we don't re-detect every refresh
    if (!pre.dataset.src){
      const chosen = await firstWorkingUrl(urlList);
      pre.dataset.src = chosen || "";
      badge.textContent = chosen ? chosen : "NOT FOUND";
    }

    const src = pre.dataset.src;
    if (!src){
      pre.textContent = "Could not find this file at any known path.\n\nTried:\n- " + urlList.join("\n- ");
      return;
    }

    try{
      const r = await fetch(src, { cache: "no-store" });
      if (!r.ok) throw new Error("HTTP " + r.status);
      const text = await r.text();
      pre.textContent = text || "(empty)";
      pre.scrollTop = pre.scrollHeight; // tail-ish behavior
    } catch(e){
      pre.textContent = `Error reading ${src}\n${e}`;
    }
  }

  function nowLine(){
    const d = new Date();
    return `Auto-refresh ${Math.round(REFRESH_MS/1000)}s • ${d.toUTCString()} • Desk Mode (15")`;
  }

  async function tick(){
    document.getElementById("meta").textContent = nowLine();

    await Promise.all([
      loadInto("bw","src-bw", CANDIDATES.blockwatchLog),
      loadInto("wg","src-wg", CANDIDATES.walletguardLog),
      loadInto("bf","src-bf", CANDIDATES.blockfound),
      loadInto("h","src-h", CANDIDATES.height),
      loadInto("s","src-s", CANDIDATES.status),
    ]);
  }

  tick();
  setInterval(tick, REFRESH_MS);
</script>

</body>
</html>
